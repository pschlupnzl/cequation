<!doctype html>
<html>
<head>
    <title>CEquation</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="style.css" />
    <script src="v2/cequation.js"></script>
    <script src="v2/constants.js"></script>
    <script src="v2/utils.js"></script>
    <script src="v2/unit.js"></script>
    <script src="v2/parse.js"></script>
    <script src="v2/eval.js"></script>
    <script src="v2/tests.js"></script>
    <script>
        window.addEventListener('DOMContentLoaded', function () {
            const txtVarNames = [].slice.call(document.querySelectorAll(".txtVarName"));
            const txtVarVals =  [].slice.call(document.querySelectorAll(".txtVarVal"));
            const txtEqn = document.getElementById("txtEqn");
            const txtAns = document.getElementById("txtAns");
            const txtAnsUnit = document.getElementById("txtAnsUnit");
            const divStack = document.getElementById("divStack");

            const update = function () {
                const eqn = txtEqn.value;
                let err = null;
                let errPos = 0;
                const tokens = CEquation.parse(eqn, function (eq, pos, msg, tok) {
                    if (!err) {
                        errPos = pos;
                        err = msg;
                    }
                });
                divStack.innerText = eqn + "\n\n";
                divStack.innerText += tokens && CEquation.utils.toString(tokens) || "";
                let ans = tokens && CEquation.evaluate(tokens, function (pos, msg) {
                    if (!err) {
                        errPos = pos;
                        err = msg;
                    }
                });
                if (err) {
                    txtAns.innerHTML = new Array(errPos).join("&nbsp;") + " ^ " + err;
                    txtAnsUnit.innerText = "";
                } else {
                    ans = CEquation.Unit.simplify(ans);
                    txtAns.innerText = CEquation.utils.stripRoundoff(ans.value);
                    txtAnsUnit.innerText = ans.unit.toString();
                }
            }

            // const tests = CEquation.runTests();
            // const butTests = document.getElementById("butTests");
            // butTests.innerText = `Tests: ${tests.passed} passed, ${tests.failed} failed, ${tests.total} total`;
            // butTests.addEventListener("click", function () {
            //     CEquation.runTests();
            // });

            txtEqn.addEventListener("keyup", update);
            update();
        })
    </script>
</head>
<body>
    <table class="inputEquation">
        <tr>
            <td>Equation: </td>
            <td><input 
                type="text"
                id="txtEqn"
                class="monospace"
                x-value="  1 +  2*3  "
                x-value="3/s"
                x-value="x + sin(y * pi) + max(0, 1)"
                x-value="(1 + 2) * 3 - sin(.5) / sqrt(pi)"
                x-value="3 mJ"
                x-value="2 g"
                x-value="1m/s + 2m/ms"
                x-value="3s * 2us"
                x-value="3 s^2/J^2"
                x-value="(10 cm)^3"
                value="10mJ < 1J"
                /></td>
        </tr>
        <tr>
            <td>Ans = </td>
            <td>
                <span id="txtAns" class="monospace"></span>
                <span id="txtAnsUnit"></span>
            </td>
        </tr>
    </table>

    <!-- <table class="variables">
        <thead>
            <tr><th>Variable</th><th></th><th>Value</th></tr>
        </thead>
        <tbody>
            <tr><td><input type="text" class="txtVarName" value="x" /></td><td> = </td><td><input type="text" class="txtVarVal" value="5" /></td></tr>
            <tr><td><input type="text" class="txtVarName" value="y" /></td><td> = </td><td><input type="text" class="txtVarVal" value="0.25" /></td></tr>
            <tr><td><input type="text" class="txtVarName" value="z" /></td><td> = </td><td><input type="text" class="txtVarVal" value="1" /></td></tr>
        </tbody>
    </table> -->
    <pre id="divStack"></pre>
    <div>
        <button id="butTests">Tests</button>
    </div>
</body>
</html>